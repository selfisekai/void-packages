# Template file for 'insomnia'
pkgname=insomnia
version=2020.3.3
revision=1
archs="x86_64" # electron
wrksrc="insomnia-core-${version}"
build_style=nodejs
hostmakedepends="nodejs-lts-10"
makedepends="gcc python3 fontconfig-devel"
short_desc="Desktop API client for REST and GraphQL"
maintainer="selfisekai <laura@selfisekai.rocks>"
license="MIT"
homepage="https://insomnia.rest/"
distfiles="https://github.com/Kong/insomnia/archive/core@${version}.tar.gz"
checksum=82f3e7662944624ba45726e8ee9f776aa19b8f2a31f9767f2c2bc8ca0411844f
nostrip_files="insomnia"

do_build() {
	npm run bootstrap
	GIT_TAG="core@${version}" BUILD_TARGETS=dir npm run app-package
}

do_install() {
	vmkdir usr/lib/insomnia
	vcopy packages/insomnia-app/dist/linux-unpacked/* usr/lib/insomnia

	vmkdir usr/bin
	ln -sf /usr/lib/insomnia/insomnia ${DESTDIR}/usr/bin/

	vmkdir usr/share/pixmaps
	vinstall packages/insomnia-app/app/static/icon.png 664 usr/share/pixmaps insomnia.png

	vmkdir usr/share/applications
	vinstall ${FILESDIR}/insomnia.desktop 775 usr/share/applications

	vlicense LICENSE
}
